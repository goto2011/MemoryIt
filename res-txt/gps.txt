// GPS
// V0.2

Q:GPS分为AGPS和传统GPS
A:传统GPS即纯GPS。AGPS即辅助GPS，在传统GPS加一些辅助定位手段，以加快定位速度；辅助手段只是为了加快定位速度，真正的定位数据还是和传统GPS一样，来自于卫星。两者的主要流程是一样的。
Q:AGPS的原理和优势
A:AGPS依赖数据业务，从数据业务中获取星历、频率、位码等信息，尽快确认当前位置可用的卫星。能将首次定位的时间缩减为几秒，而不是几十秒；提高接受天线的灵敏度。
Q:AGPS的分类
A:按数据的来源，可分为高通服务器、google服务器、第三方wifi数据服务器、运营商服务器。实现的协议不同，但功能大同小异。常用的是高通服务器。
Q:传统GPS的种类
A:按高通的说法，分为第7代和第8代。7代使用20颗GPS；8代则同时使用20课GPS和24颗GLONASS卫星（俄罗斯）。后者更快更准确、功耗更低，因为数据源更多了。
Q:广义的位置定位（Location）
A:除了GPS外，还有其它几种方式获得位置信息。所以现在广义的GPS指的是利用多种技术方案，综合的给出位置信息。当然目前android手机上这个逻辑层次上有点乱。
Q:广义的位置定位的分类
A:主要有如下几种：（1）网络定位（即cell info），注意这个不算是运营商服务器的AGPS；（2）GPS（AGPS），即利用google服务器的AGPS；（3）XTreme，利用高通服务器的AGPS。
Q:UVP，统一定位
A:综合小区信息、wifi热点和GPS信号，同时支持室外和室内定位，并做到快速、精度高和功耗底，这个是将来发展的方向。
Q:GPS启动的种类
A:分为冷启动和热启动。冷启动是指第一次定位；其它启动均为热启动，因为此时手机已经记忆了上次定位的信息，可以作为参考。当然，上次定位信息的参考价值随着时间的推移会逐步降低，因为人的活动的。有效期是2个小时。
Q:高通GPS方案
A:GPS代码主要放在modem侧，ap侧通过rpc和modem侧的gpsone task通讯。同时，AGPS依赖的IP协议栈，也同时分布在modem和ap侧，相互通过rpc通讯。
Q:定位分为网络发起和手机发起
A:前者又分为MSA和MSB，MSA即网络侧计算，手机只复杂返回卫星数据，主要是方便网络侧监控，目前高通方案上不会给用户任何提示。MSB是手机侧计算，手机把算出来的坐标发给网络侧。手机发起的叫stand alone，这个就是大家日常使用的一种。
Q:代码分层1
A:app层有 location manager service 和 gps location provider，给应用提供gps相关api。
Q:代码分层2
A:framework层有 libgps.so，app层通过jni调用。
Q:代码分层3
A:kernel层就是kernel driver。 

Q:四种导航系统的精度
A:GPS、Gloness是分米级，伽利略是米级，北斗是十米级。
Q:GPS的精度
A:GPS的设计精度为10米，结果实际精度达到了3米。从统计学角度，则意味着你的GPS位置，距离你的实际位置在30米内的概率是95%；对于高度读数，精度在45-100米的概率是95%。

Q:google AGPS服务器
A:google AGPS服务器全球免费，如果运营商没有特殊要求就可以用。中国运营商都不允许用。
Q:AGPS定制
A:主要修改nv 4703、4707、3758以及supl证书。

Q:google地图无定位权限问题如何解决？
A:系统设置--位置服务--位置和GOOGLE搜索--开
Q:冷启动定位
A:冷启动定位包括首次定位、移动到另外一个城市首次定位和时间间隔超过2小时后定位等几种情况。高通平台上，冷启动定位需要三四分钟时间。

Q:冷启动定位
A:用高通的ar 6005芯片，需要3-4分钟。比较慢。

Q:基站定位
A:有两种：（1）cell-id，获取一个基站的信息即可完成定位，定位块，精度较差。（2）OTDOA定位。要求获取周围3个以上基站的信息，定位精度比CELLID高。
Q:Wifi热点定位
A:利用wifi热点定位，优势是精度高，并支持室内定位。缺点是依赖于wifi热点数据库。Wifi热点数据库业界有google和skyhook。
Q:GPS卫星定位（4-1）
A:纯GPS定位，利用GPS卫星定位。
Q:GPS卫星定位（4-2）
A:AGPS定位。利用运营商的AGPS服务器提供的信息加速GPS定位。其服务器、数据格式等出自3G协议的规定。本质上讲，AGPS服务器就是个网站，网址类似如：http://agps.movistar.es:7275。
Q:GPS卫星定位（4-3）
A:GPS xtra定位。利用高通自己的xtra服务器提供的信息加速GPS定位。走纯粹的数据通道，和3G协议无关。访问方式和访问一个网站没有两样。
Q:GPS卫星定位（4-4）
A:CDMA网络下基站下发的系统参数消息SPM里面的BASE_LAT、BASE_LONG 2个值为基站天线的经纬度，可利用该信息来加速定位。除这个之外，在高通GPSone方案中，象sim卡国家码也会作为辅助定位信息的一部分来参与定位过程。
Q:高通GPSone方案的多层次定位
A:（1）mcc/mnc，可获得National code；（2）Base lat/long broadcast；（3）cell -db；（3）A-gps server；（4）ODP GPS；（5）wifi ap
Q:基站定位的原理
A:
Q:GPS系统
A:由空间卫星星座部分(24颗在轨卫星) + 地面监控部分（授时，必须；网维，非必须） + 用户设备部分（GPS接收机）
Q:GPS授时中心
A:授时中心采用铯原子钟，保持24颗卫星的时间高精度一致。
Q:GPS接收机
A:包含天线，射频单元，基带处理单元，存储单元。主要目的是测量出GPS信号从卫星到接收机天线的传播时间，实时地计算出接收机的三维位置，三维速度和时间。
Q:GPS定位原理
A:简而言之就是3颗星可定位平面坐标，即3个3元2次方程可确定一个三元组（平面坐标，以及接收机的钟差）；4颗星可确定三维坐标，即4个4元2次方程可确定一个四元组（三维坐标，以及接收机的钟差）。
Q:方程组解释（1）
A:上述四个方程式中x、y、z为待测点坐标，Vto为接收机的钟差为未知参数，其中di=c△ti，(i=1、2、3、4)，di分别为卫星ｉ到接收机之间的距离，△ti 分别为卫星ｉ的信号到达接收机所经历的时间，xi 、yi 、zi为卫星ｉ在t时刻的空间直角坐标，Vti为卫星钟的钟差，c为光速。
Q:方程组解释（2）
A:xi、yi（i=1-4）即卫星的三维位置，时间一定，这个值就是固定的。所谓星历的目的就是根据时间计算卫星位置三维坐标的。
Q:方程组解释（3）
A:关键点是di如何确定。每个gps信号自身都带有一个时间戳，告知接收方我这个信号何时从卫星发出。
Q:方程组解释（4）
A:因为接收方（比如手机）没有高精度时间，所以需要4颗卫星来定位，第四颗星负责校准钟差，即接收方和GPS时钟的时钟差异。
Q:高通平台首次定位的要求
A:冷启动CN0值必须在28db以上，必须保持30s以上。
Q:星历包括什么？
A:包含了轨道信息（天体坐标系）、时间、卫星状态等很多信息的。这中间包括了天体坐标到空间坐标的转换。手机的星历可以从GPS卫星数据中解析，也可以从AGPS服务器上下载。星历有很多种。
Q:AGPS服务器
A:是专门存储和转发卫星状态的服务器，一般叫PDE 服务器，position determination entry。手机通过数据业务访问（和基站位置等没有关系）。
Q:AGPS服务器保存在何处？
A:高通方案中，服务器IP地址是预置在efs中的，不同的运营商的AGPS服务器地址是不相同的。
Q:与GPS误差相关的因素（1）
A:美国政府因素（注意，2000年时克林顿已经下令取消）。
Q:与GPS误差相关的因素（2）
A:卫星星历误差。在进行GPS定位时，计算在某时刻GPS卫星位置所需的卫星轨道参数是通过星历提供的，单通过星历所计算出的卫星位置都会与其真实位置有所差异，这就是所谓的星历误差。
Q:与GPS误差相关的因素（3）
A:卫星钟的钟误差，是GPS卫星上所安装的原子钟的钟面时与GPS标准时间的误差。
Q:与GPS误差相关的因素（4）
A:卫星信号发射天线相位中心偏差，是GPS卫星上信号发射天线的标称相位中心与其真实相位中心之间的差异。
Q:GPS导航电文内容
A:分为5个子帧:  子帧1－标识码，星钟数据龄期，卫星时钟校准数；子帧2，3－卫星星历；子帧4，5－其它卫星的健康状况，历书，电离层改正参数。
Q:GPS导航电文更新时间
A:2小时
Q:GPS导航电文长度
A:每帧长1500bits，以50bits/s传输，需要30sec；二进制码形式发给用户，数据码，即D码。
Q:AGPS下载辅助星历的方式
A:有两种，CP走的是专用的信令通道，UP走的是数据信道。
Q:UMTS和CDMA UP的差异
A:UMTS有加密设置， 使用SUPL证书。CDMA 则不需要加密
Q:QXDM LOG分析
A:定位开始 pdsm_get_position()
PDSM_MSG_HIGH("--------- GPS Command --------------------",0,0,0);
PDSM_MSG_HIGH("pdsm_get_position()",0,0,0);
PDSM_MSG_HIGH("------------------------------------------",0,0,0);
Q:定位结束
A:PDSM_MSG_HIGH("--------- GPS Command --------------------",0,0,0);
PDSM_MSG_HIGH("pdsm_end_session()",0,0,0);
PDSM_MSG_HIGH("------------------------------------------",0,0,0);
Q:是否正常发起定位
A:查看log： loc_pd.c 的 loc_pd_process_fix_request（） ，"calling pdsm_get_position server option %d, mode =%d\n"
Q:定位的环境是室内还是室外
A:
Q:分析冷启动的log
A:
Q:典型问题：CDMA下无法发起AGPS或者AGPS定位不成功。
A:CDMA网络信令会提供基站坐标，GPSone会使用这个数据。但是中国电信的大量使用假数据，导致用了比不用还差。解决方法：关闭AGPS可解决。
Q:关闭AGPS的消极影响
A:导致室外定位时间延长（慢10s以上），且室内无法定位。
Q:典型问题：WCDMA下证书问题
A:证书的有效期，手机安全时间必须设置为当前时间；编码格式。Cer编码还是Der编码；编码格式。Cer编码还是Der编码；是否为证书链。如果是证书链，则放在/SUPL下，如果仅是证书，则放在/cert下。
Q:证书问题
A:查看pd_comms_tcp_task.c、secx509.c和secssli.c,如果报“Certificate Contains Invalid Data”，则证书失效。
Q:高通AGPS工具
A:SnapperHS，高通AGPS工具SnapperHS简介.doc
Q:GPS代码结构
A:参见文档：GPS模块代码架构及修改规则.docx



